{
	"name": "02 - Create stage views",
	"properties": {
		"folder": {
			"name": "Dive into Delta Lake"
		},
		"content": {
			"query": "/*\nDROP SCHEMA stage;\n\nCREATE SCHEMA stage;\n*/\n\nDROP VIEW IF EXISTS stage.taxi_trip_2017;\nGO\n\nCREATE VIEW stage.taxi_trip_2017\nAS \nSELECT\nCAST(VendorID AS int) AS VendorID\n,CAST(tpep_pickup_datetime AS SMALLDATETIME) AS tpep_pickup_datetime\n,CAST(tpep_dropoff_datetime AS SMALLDATETIME) AS tpep_dropoff_datetime\n,CAST(passenger_count AS int) AS passenger_count \n,CAST(trip_distance AS decimal(7,2)) AS trip_distance \n,CAST(RatecodeID AS int) AS RatecodeID\n,CAST(store_and_fwd_flag AS char(1)) AS store_and_fwd_flag\n,CAST(PULocationID AS int) AS PULocationID\n,CAST(DOLocationID AS int) AS DOLocationID\n,CAST(NULL AS int) AS ZoneKey\n,CAST(payment_type AS int) AS payment_type\n,CAST(fare_amount AS decimal(7,2)) AS fare_amount\n,CAST(extra AS decimal(7,2)) AS extra\n,CAST(mta_tax AS decimal(7,2)) AS mta_tax\n,CAST(tip_amount AS decimal(7,2)) AS tip_amount\n,CAST(tolls_amount AS decimal(7,2)) AS tolls_amount\n,CAST(improvement_surcharge AS decimal(7,2)) AS improvement_surcharge\n,CAST(total_amount AS decimal(7,2)) AS total_amount\n,SUBSTRING(CAST(tpep_pickup_datetime AS varchar(16)),1,7) AS YYYYMM\nFROM \n    OPENROWSET(\n        BULK 'https://spoexxbkqfmujmvmpoc.dfs.core.windows.net/raw/nyc-tlc/trip-data/yellow/*_2017-*.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        HEADER_ROW = TRUE\n) raw_data;\nGO\n\nDROP VIEW IF EXISTS stage.taxi_trip_2018;\nGO\n\nCREATE VIEW stage.taxi_trip_2018\nAS \nSELECT\nCAST(VendorID AS int) AS VendorID\n,CAST(tpep_pickup_datetime AS SMALLDATETIME) AS tpep_pickup_datetime\n,CAST(tpep_dropoff_datetime AS SMALLDATETIME) AS tpep_dropoff_datetime\n,CAST(passenger_count AS int) AS passenger_count \n,CAST(trip_distance AS decimal(7,2)) AS trip_distance \n,CAST(RatecodeID AS int) AS RatecodeID\n,CAST(store_and_fwd_flag AS char(1)) AS store_and_fwd_flag\n,CAST(PULocationID AS int) AS PULocationID\n,CAST(DOLocationID AS int) AS DOLocationID\n,CAST(NULL AS int) AS ZoneKey\n,CAST(payment_type AS int) AS payment_type\n,CAST(fare_amount AS decimal(7,2)) AS fare_amount\n,CAST(extra AS decimal(7,2)) AS extra\n,CAST(mta_tax AS decimal(7,2)) AS mta_tax\n,CAST(tip_amount AS decimal(7,2)) AS tip_amount\n,CAST(tolls_amount AS decimal(7,2)) AS tolls_amount\n,CAST(improvement_surcharge AS decimal(7,2)) AS improvement_surcharge\n,CAST(total_amount AS decimal(7,2)) AS total_amount\n,SUBSTRING(CAST(tpep_pickup_datetime AS varchar(16)),1,7) AS YYYYMM\nFROM \n    OPENROWSET(\n        BULK 'https://spoexxbkqfmujmvmpoc.dfs.core.windows.net/raw/nyc-tlc/trip-data/yellow/*_2018-*.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        HEADER_ROW = TRUE\n) raw_data;\nGO\n\nDROP VIEW IF EXISTS stage.taxi_trip_2019;\nGO\n\nCREATE VIEW stage.taxi_trip_2019\nAS \nSELECT\nCAST(VendorID AS int) AS VendorID\n,CAST(tpep_pickup_datetime AS SMALLDATETIME) AS tpep_pickup_datetime\n,CAST(tpep_dropoff_datetime AS SMALLDATETIME) AS tpep_dropoff_datetime\n,CAST(passenger_count AS int) AS passenger_count \n,CAST(trip_distance AS decimal(7,2)) AS trip_distance \n,CAST(RatecodeID AS int) AS RatecodeID\n,CAST(store_and_fwd_flag AS char(1)) AS store_and_fwd_flag\n,CAST(PULocationID AS int) AS PULocationID\n,CAST(DOLocationID AS int) AS DOLocationID\n,CAST(NULL AS int) AS ZoneKey\n,CAST(payment_type AS int) AS payment_type\n,CAST(fare_amount AS decimal(7,2)) AS fare_amount\n,CAST(extra AS decimal(7,2)) AS extra\n,CAST(mta_tax AS decimal(7,2)) AS mta_tax\n,CAST(tip_amount AS decimal(7,2)) AS tip_amount\n,CAST(tolls_amount AS decimal(7,2)) AS tolls_amount\n,CAST(improvement_surcharge AS decimal(7,2)) AS improvement_surcharge\n,CAST(total_amount AS decimal(7,2)) AS total_amount\n,SUBSTRING(CAST(tpep_pickup_datetime AS varchar(16)),1,7) AS YYYYMM\nFROM \n    OPENROWSET(\n        BULK 'https://spoexxbkqfmujmvmpoc.dfs.core.windows.net/raw/nyc-tlc/trip-data/yellow/*_2019-*.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        HEADER_ROW = TRUE\n) raw_data;\nGO\n\nDROP VIEW IF EXISTS stage.taxi_trip_2020;\nGO\n\nCREATE VIEW stage.taxi_trip_2020\nAS \nSELECT\nCAST(VendorID AS int) AS VendorID\n,CAST(tpep_pickup_datetime AS SMALLDATETIME) AS tpep_pickup_datetime\n,CAST(tpep_dropoff_datetime AS SMALLDATETIME) AS tpep_dropoff_datetime\n,CAST(passenger_count AS int) AS passenger_count \n,CAST(trip_distance AS decimal(7,2)) AS trip_distance \n,CAST(RatecodeID AS int) AS RatecodeID\n,CAST(store_and_fwd_flag AS char(1)) AS store_and_fwd_flag\n,CAST(PULocationID AS int) AS PULocationID\n,CAST(DOLocationID AS int) AS DOLocationID\n,CAST(NULL AS int) AS ZoneKey\n,CAST(payment_type AS int) AS payment_type\n,CAST(fare_amount AS decimal(7,2)) AS fare_amount\n,CAST(extra AS decimal(7,2)) AS extra\n,CAST(mta_tax AS decimal(7,2)) AS mta_tax\n,CAST(tip_amount AS decimal(7,2)) AS tip_amount\n,CAST(tolls_amount AS decimal(7,2)) AS tolls_amount\n,CAST(improvement_surcharge AS decimal(7,2)) AS improvement_surcharge\n,CAST(total_amount AS decimal(7,2)) AS total_amount\n,SUBSTRING(CAST(tpep_pickup_datetime AS varchar(16)),1,7) AS YYYYMM\nFROM \n    OPENROWSET(\n        BULK 'https://spoexxbkqfmujmvmpoc.dfs.core.windows.net/raw/nyc-tlc/trip-data/yellow/*_2020-*.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        HEADER_ROW = TRUE\n) raw_data;\nGO\n\nDROP VIEW IF EXISTS stage.taxi_zone;\nGO\n\nCREATE VIEW stage.taxi_zone\nAS \nSELECT\nCAST(LocationID AS int) AS LocationID\n,CAST(Borough AS varchar(64)) AS Borough\n,CAST(Zone AS varchar(64)) AS Zone\n,CAST(service_zone AS varchar(64)) AS ServiceZone\nFROM \n    OPENROWSET(\n        BULK 'https://spoexxbkqfmujmvmpoc.dfs.core.windows.net/raw/nyc-tlc/lookup-data/taxi_zone_lookup.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION='2.0',\n        HEADER_ROW = TRUE\n) raw_data;\nGO\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc-taxi",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}